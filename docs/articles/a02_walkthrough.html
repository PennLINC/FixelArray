<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ModelArray">
<title>Example walkthrough • ModelArray</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example walkthrough">
<meta property="og:description" content="ModelArray">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ModelArray</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a01_installations.html">Installation</a>
    <a class="dropdown-item" href="../articles/a02_walkthrough.html">Example walkthrough</a>
    <a class="dropdown-item" href="../articles/a03_ModelArray_basics.html">ModelArray Quick Start</a>
    <a class="dropdown-item" href="../articles/a04_basic_r_intro.html">An intro to R</a>
    <a class="dropdown-item" href="../articles/a05_doc_for_developer.html">Developer documentation</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">

<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Example walkthrough</h1>
            
      
      
      <div class="d-none name"><code>a02_walkthrough.Rmd</code></div>
    </div>

    
    
<p>In this example walkthrough, we will use some toy data (____TODO: TO UPDATE_____) to demonstrate the steps of using ModelArray and its companion python package ConFixel. By following the <code><a href="../articles/a01_installations.html">vignette("a01_installations")</a></code> page, you should have successfully installed <code>ModelArray</code>, <code>ConFixel</code>, and <code>MRtrix</code>. We expect that at least <code>ConFixel</code> has been installed in a conda environment called “modelarray”.</p>
<div class="section level2">
<h2 id="step-1--prepare-your-data">Step 1. Prepare your data<a class="anchor" aria-label="anchor" href="#step-1--prepare-your-data"></a>
</h2>
<p>Assume you’re at folder <code>myProject</code>. In a terminal console:</p>
<pre class="console"><code>$ cd ~
$ mkdir myProject
$ cd ~/myProject</code></pre>
<p>Assume you are at the stage where you have got fixel data from MRtrix by following the fixel-based analysis. If we use paper <a href="https://doi.org/10.1016/j.neuroimage.2021.118417" class="external-link">Dhollander et al., 2021</a> Fig.3. The fixel-based analysis pipeline as an example, we expect you have done the step “Connectivity-based fixel smoothing”. You will use the subject-level fixel data in template space from this step for further fixel-wise statistical analysis in ModelArray. We expect the file format is mif.</p>
<p>Here, we provide some toy data (<strong><em>TODO: TO UPDATE </em></strong>__). You can get them by:</p>
<pre class="console"><code>$ wget xxxxxx # TODO
$ unzip xxxx # TODO
$ rm xxx.zip   # TODO</code></pre>
<div class="section level3">
<h3 id="step-1-1--overview-of-the-data-organization">Step 1.1. Overview of the data organization<a class="anchor" aria-label="anchor" href="#step-1-1--overview-of-the-data-organization"></a>
</h3>
<p>As you can see, the data is organized in the following way: # TODO: to update this tree</p>
<pre class="console"><code>~/myProject
|
├── cohort_FD.csv   
│
├── FD
│   ├── index.mif
│   ├── directions.mif
|   ├── sub1_FD.mif
|   ├── sub2_FD.mif
|   ├── sub3_FD.mif
│   ├── ...
└── ...</code></pre>
<p>This data organization is what we recommend. In this example fixel dataset, the metric is <code>FD</code>. If you have other metrics such as FD, you may also have folder <code>FD</code> and CSV file <code>cohort_FD.csv</code> in this <code>myProject</code> folder.</p>
<p>As you can see, besides subject-level fixel data, there are also <code>index.mif</code> and <code>directions.mif</code>. These two files provides important information of the fixel locations - see their definitions <a href="https://userdocs.mrtrix.org/en/dev/fixel_based_analysis/fixel_directory_format.html" class="external-link">here</a>.</p>
</div>
<div class="section level3">
<h3 id="step-1-2--prepare-a-csv-file-of-cohort-phenotypes">Step 1.2. Prepare a CSV file of cohort phenotypes<a class="anchor" aria-label="anchor" href="#step-1-2--prepare-a-csv-file-of-cohort-phenotypes"></a>
</h3>
<p>In addition to fixel data, we also need a CSV file of cohort phenotypes. This file will be used by both ConFixel and ModelArray. Here we provide an example CSV file: <code>cohort_FD.csv</code>: # TODO: update this table below based on the real CSV file</p>
<table class="table">
<thead><tr class="header">
<th align="center"><strong><em>scalar_name</em></strong></th>
<th align="center"><strong><em>source_file</em></strong></th>
<th align="center">subject_id</th>
<th align="center">age</th>
<th align="center">sex</th>
<th align="center">…</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">FD</td>
<td align="center">FD/sub1_FD.mif</td>
<td align="center">sub1</td>
<td align="center">10</td>
<td align="center">F</td>
<td align="center">…</td>
</tr>
<tr class="even">
<td align="center">FD</td>
<td align="center">FD/sub2_FD.mif</td>
<td align="center">sub2</td>
<td align="center">20</td>
<td align="center">M</td>
<td align="center">…</td>
</tr>
<tr class="odd">
<td align="center">FD</td>
<td align="center">FD/sub3_FD.mif</td>
<td align="center">sub3</td>
<td align="center">15</td>
<td align="center">F</td>
<td align="center">…</td>
</tr>
<tr class="even">
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
</tr>
</tbody>
</table>
<p>We expect this CSV file at least contains these two columns highlighted in <strong><em>bold and italics</em></strong>:</p>
<ul>
<li>
<code>scalar_name</code>: how should we call your metric?</li>
<li>
<code>source_file</code>: the filename of the subject-level fixel data. In the next step of data conversion with ConFixel, we will use <code>~/myProject</code> as the main folder (<code>relative_root</code>), so here, we only need to provide the path starting from folder <code>FD</code>.</li>
</ul>
<p>Other columns are optional - simply add covariates you’ll use in the statistical analysis in ModelArray. The order of columns can be changed.</p>
</div>
<div class="section level3">
<h3 id="step-1-3--convert-data-into-a-hdf5-file-using-confixel">Step 1.3. Convert data into a HDF5 file using ConFixel<a class="anchor" aria-label="anchor" href="#step-1-3--convert-data-into-a-hdf5-file-using-confixel"></a>
</h3>
<p>One reason that <code>ModelArray</code> is memory efficient is it takes advantages of Hierarchical Data Format 5 (HDF5) file format. The extension of this file format is “h5”. An HDF5 file stores large dataset hierarchically. We now use ConFixel to convert these list of mif files into an HDF5 file: In the terminal console:</p>
<pre class="console"><code>$ conda activate modelarray
$ confixel \
    --index-file FD/index.mif \
    --directions-file FD/directions.mif \
    --cohort-file cohort_FD.csv \
    --relative-root ~/myProject \
    --output-hdf5 FD.h5</code></pre>
<p>As mentioned before, here we take <code>~/myProject</code> as the main folder, and you don’t need to repeat it in the filenames for these input and output files anymore (i.e. these filenames are relative path based on this main folder).</p>
<p>When running <code>confixel</code>, you will see a moving progress bar. When it finishes, it looks like this:</p>
<p>TODO: add a screenshot of confixel’s conversion!</p>
<p>Now you got the converted HDF5 file in folder <code>~/myProject</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="step-2--use-modelarray-to-perform-statistical-analysis">Step 2. Use ModelArray to perform statistical analysis<a class="anchor" aria-label="anchor" href="#step-2--use-modelarray-to-perform-statistical-analysis"></a>
</h2>
<p>The next step is to use this HDF5 file and the CSV file we prepared to perform statistical analysis in R. Now launch R with the way you preferred: * You can launch RStudio * If you installed xxx in conda: XXXXXXXXX * If ModelArray was not installed in conda environment, you can simply open RStudio * Some clusters may not provide good graphic access to RStudio and it may be hard to install R packages. In this case, you may use the container we provide. You can start an R session by: <code>singularity run --cleanenv ${modelarray_singularity} R</code>. For details please see <code><a href="../articles/a01_installations.html">vignette("a01_installations")</a></code> page.</p>
<p>All the commands in this Step 2 section will be run in R.</p>
<div class="section level3">
<h3 id="step-2-1--load-modelarray-package-in-r">Step 2.1. Load ModelArray package in R<a class="anchor" aria-label="anchor" href="#step-2-1--load-modelarray-package-in-r"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pennlinc.github.io/ModelArray">ModelArray</a></span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-2-2--create-a-modelarray-class-object">Step 2.2. Create a ModelArray-class object<a class="anchor" aria-label="anchor" href="#step-2-2--create-a-modelarray-class-object"></a>
</h3>
<p>To create a ModelArray-class object that represents the HDF5 file of fixel data, we need the HDF5 filename and the scalar’s name:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># filename of example fixel data (.h5 file):</span>
<span class="va">h5_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"n50_fixels.h5"</span>, package <span class="op">=</span> <span class="st">"ModelArray"</span><span class="op">)</span>
<span class="co"># create a ModelArray-class object:</span>
<span class="va">modelarray</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ModelArray.html">ModelArray</a></span><span class="op">(</span><span class="va">h5_path</span>, 
                         scalar_types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FD"</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<p>Let’s check what’s in it:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelarray</span></code></pre></div>
<pre><code><span class="co">## ModelArray located at /tmp/RtmpPpHvS2/temp_libpathdc373e23af92/ModelArray/extdata/n50_fixels.h5</span>
<span class="co">## </span>
<span class="co">##   Source files:     50</span>
<span class="co">##   Scalars:          FD</span>
<span class="co">##   Analyses:</span></code></pre>
<p>This shows that there are ___ ? 50 ?___ source FD files in this <code>modelarray</code> you loaded.</p>
<p>To access this ModelArray object’s slots:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">scalars</span><span class="op">(</span><span class="va">modelarray</span><span class="op">)</span><span class="op">[[</span><span class="st">"FD"</span><span class="op">]</span><span class="op">]</span>   <span class="co"># FD data</span></code></pre></div>
<pre><code><span class="co">## &lt;182581 x 50&gt; matrix of class DelayedMatrix and type "double":</span>
<span class="co">##            FD/sub1_fd.mif  FD/sub2_fd.mif ... FD/sub49_fd.mif FD/sub50_fd.mif</span>
<span class="co">##      [1,]      36.0214119      81.9753342   .        37.82116       237.40558</span>
<span class="co">##      [2,]    1046.6225586    1058.1074219   .      1085.59241       986.08856</span>
<span class="co">##      [3,]       0.2467898      83.6336441   .        20.79962       108.81217</span>
<span class="co">##      [4,]       0.6753999      72.3661575   .        13.40481       120.06551</span>
<span class="co">##      [5,]       0.2290502       1.7837602   .       132.53795        15.16265</span>
<span class="co">##       ...               .               .   .               .               .</span>
<span class="co">## [182577,]      0.02690634     14.75695896   .       31.983732      150.156906</span>
<span class="co">## [182578,]      0.04722600     23.99450111   .       27.997149       83.266426</span>
<span class="co">## [182579,]      0.11819888     43.39178085   .       61.914310       99.171700</span>
<span class="co">## [182580,]     32.06180573     11.31695938   .       13.557989        3.398834</span>
<span class="co">## [182581,]      9.01556969     12.15083504   .       35.347015       21.815554</span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">sources</span><span class="op">(</span><span class="va">modelarray</span><span class="op">)</span><span class="op">[[</span><span class="st">"FD"</span><span class="op">]</span><span class="op">]</span>  <span class="co"># list of source filenames for FD data</span></code></pre></div>
<pre><code><span class="co">##  [1] "FD/sub1_fd.mif"  "FD/sub2_fd.mif"  "FD/sub3_fd.mif"  "FD/sub4_fd.mif" </span>
<span class="co">##  [5] "FD/sub5_fd.mif"  "FD/sub6_fd.mif"  "FD/sub7_fd.mif"  "FD/sub8_fd.mif" </span>
<span class="co">##  [9] "FD/sub9_fd.mif"  "FD/sub10_fd.mif" "FD/sub11_fd.mif" "FD/sub12_fd.mif"</span>
<span class="co">## [13] "FD/sub13_fd.mif" "FD/sub14_fd.mif" "FD/sub15_fd.mif" "FD/sub16_fd.mif"</span>
<span class="co">## [17] "FD/sub17_fd.mif" "FD/sub18_fd.mif" "FD/sub19_fd.mif" "FD/sub20_fd.mif"</span>
<span class="co">## [21] "FD/sub21_fd.mif" "FD/sub22_fd.mif" "FD/sub23_fd.mif" "FD/sub24_fd.mif"</span>
<span class="co">## [25] "FD/sub25_fd.mif" "FD/sub26_fd.mif" "FD/sub27_fd.mif" "FD/sub28_fd.mif"</span>
<span class="co">## [29] "FD/sub29_fd.mif" "FD/sub30_fd.mif" "FD/sub31_fd.mif" "FD/sub32_fd.mif"</span>
<span class="co">## [33] "FD/sub33_fd.mif" "FD/sub34_fd.mif" "FD/sub35_fd.mif" "FD/sub36_fd.mif"</span>
<span class="co">## [37] "FD/sub37_fd.mif" "FD/sub38_fd.mif" "FD/sub39_fd.mif" "FD/sub40_fd.mif"</span>
<span class="co">## [41] "FD/sub41_fd.mif" "FD/sub42_fd.mif" "FD/sub43_fd.mif" "FD/sub44_fd.mif"</span>
<span class="co">## [45] "FD/sub45_fd.mif" "FD/sub46_fd.mif" "FD/sub47_fd.mif" "FD/sub48_fd.mif"</span>
<span class="co">## [49] "FD/sub49_fd.mif" "FD/sub50_fd.mif"</span></code></pre>
</div>
<div class="section level3">
<h3 id="step-2-3--load-cohort-phenotypes-csv-file">Step 2.3. Load cohort phenotypes CSV file<a class="anchor" aria-label="anchor" href="#step-2-3--load-cohort-phenotypes-csv-file"></a>
</h3>
<p>We then load the CSV file we just used:</p>
</div>
</div>
<div class="section level2">
<h2 id="step-3--check-out-the-results">Step 3. Check out the results<a class="anchor" aria-label="anchor" href="#step-3--check-out-the-results"></a>
</h2>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Chenying Zhao, Tinashe Tapera, Matthew Cieslak.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
